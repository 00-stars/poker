#!/bin/bash
set -e # exit with nonzero exit code if anything fails
DEPLOY_ROOT="deploy"
DEPLOY_TIME=`date +"%Y%m%dT%H%M%S"`

if [ -d $DEPLOY_ROOT ]; then
  rm -rf $DEPLOY_ROOT
fi

git init $DEPLOY_ROOT

cp index.html $DEPLOY_ROOT/
cp join_session.html $DEPLOY_ROOT/
cp session.html $DEPLOY_ROOT/
cp session_new.html $DEPLOY_ROOT/
cp LICENSE $DEPLOY_ROOT/

mkdir $DEPLOY_ROOT/styles
cp index.css $DEPLOY_ROOT/styles/
cp node_modules/bootstrap/dist/css/bootstrap.min.css $DEPLOY_ROOT/styles/

mkdir $DEPLOY_ROOT/scripts
cp javascripts/* $DEPLOY_ROOT/scripts
cp node_modules/leancloud-storage/dist/av-min.js $DEPLOY_ROOT/scripts/
cp node_modules/jquery/dist/jquery.min.js $DEPLOY_ROOT/scripts/
cp node_modules/js-cookie/src/js.cookie.js $DEPLOY_ROOT/scripts/
cp node_modules/requirejs/require.js $DEPLOY_ROOT/scripts/

cd $DEPLOY_ROOT

git config user.name "CI"
git config user.email "ci@poker.dummy"

git add .
git commit -m "Deploy to GitHub Pages"
git push --force --quiet "https://$CI_USER_TOKEN@github.com/IFS49F/poker.git" master:gh-pages > /dev/null 2>&1
