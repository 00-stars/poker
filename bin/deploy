#!/bin/bash
set -e # exit with nonzero exit code if anything fails
DEPLOY_ROOT="deploy"
DEPLOY_TIME=`date +"%Y%m%dT%H%M%S"`

if [ -d $DEPLOY_ROOT ]; then
  rm -rf $DEPLOY_ROOT
fi

git init $DEPLOY_ROOT

cp index.html $DEPLOY_ROOT/
cp index.css $DEPLOY_ROOT/
cp join_session.html $DEPLOY_ROOT/
cp session.html $DEPLOY_ROOT/
cp session_new.html $DEPLOY_ROOT/
cp LICENSE $DEPLOY_ROOT/
cp -R javascripts $DEPLOY_ROOT/
cp -R node_modules $DEPLOY_ROOT/

cd $DEPLOY_ROOT

git config user.name "CI"
git config user.email "ci@poker.dummy"

git add .
git commit -m "Deploy to GitHub Pages"
git push --force --quiet "https://$CI_USER_TOKEN@github.com/IFS49F/poker.git" master:gh-pages > /dev/null 2>&1
